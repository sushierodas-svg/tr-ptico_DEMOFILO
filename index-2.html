<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eSCHOLARIS - Activity</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --naranja: #D96017;
            --amarillo: #F5BE10;
            --azul-oscuro: #183942;
            --rojo-ladrillo: #D96017;
            --azul-claro: #f0f8ff;
            --blanco: #ffffff;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            padding: 20px;
            color: var(--azul-oscuro);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Language Selector */
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            padding: 8px 16px;
            border: 2px solid var(--naranja);
            background-color: var(--blanco);
            color: var(--naranja);
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .lang-btn.active {
            background-color: var(--naranja);
            color: var(--blanco);
        }

        .lang-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(219, 96, 21, 0.3);
        }

        /* Header */
        .header {
            background: var(--azul-oscuro);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(24, 57, 66, 0.15);
        }

        .header-content h1 {
            color: var(--amarillo);
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .header-content p {
            display: none;
        }

        .logo-escolaris {
            color: var(--amarillo);
            font-size: 2.5em;
            font-weight: bold;
        }

        /* Main Content */
        .activity-section {
            background-color: var(--blanco);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .activity-title {
            color: var(--azul-oscuro);
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .activity-subtitle {
            color: var(--naranja);
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .instructions {
            background-color: var(--azul-claro);
            padding: 20px;
            border-left: 4px solid var(--naranja);
            border-radius: 8px;
            margin-bottom: 30px;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .instructions p {
            margin-bottom: 10px;
        }

        /* Table Styles */
        .table-container {
            width: 100%;
            overflow-x: auto;
            margin: 30px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th {
            background-color: var(--naranja);
            color: var(--blanco);
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border: 2px solid var(--naranja);
            font-size: 1em;
        }

        td {
            border: 2px solid #ddd;
            padding: 15px;
            min-height: 150px;
            vertical-align: top;
        }

        .row-label {
            background-color: var(--naranja);
            color: var(--blanco);
            font-weight: bold;
            width: 120px;
            text-align: center;
            font-size: 0.95em;
        }

        .cell-input {
            width: 100%;
            min-height: 140px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.95em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fafafa;
            color: var(--azul-oscuro);
            resize: vertical;
            transition: all 0.3s ease;
        }

        .cell-input:focus {
            outline: none;
            background-color: var(--blanco);
            border-color: var(--naranja);
            box-shadow: 0 0 0 3px rgba(219, 96, 21, 0.15);
        }

        .word-count {
            font-size: 0.8em;
            color: #999;
            margin-top: 5px;
            text-align: right;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--naranja) 0%, #c2531c 100%);
            color: var(--blanco);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(219, 96, 21, 0.3);
        }

        .btn-secondary {
            background-color: var(--azul-oscuro);
            color: var(--blanco);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(36, 75, 90, 0.3);
        }

        /* Messages */
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
            display: block;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--azul-oscuro);
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .header-content h1 {
                font-size: 1.5em;
            }

            .activity-section {
                padding: 20px;
            }

            .activity-title {
                font-size: 1.3em;
            }

            .language-selector {
                position: static;
                margin-bottom: 20px;
            }

            th, td {
                padding: 10px;
                font-size: 0.85em;
            }

            .cell-input {
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="language-selector">
        <button class="lang-btn active" onclick="changeLanguage('en')">EN</button>
        <button class="lang-btn" onclick="changeLanguage('es')">ES</button>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1 id="header-title">TASK / INVESTIGATION</h1>
                <p id="header-subtitle">Escolaris - Education to Transcend</p>
            </div>
            <div class="logo-escolaris">üìö</div>
        </div>

        <div class="activity-section">
            <h2 class="activity-title" id="activity-title">TRIPTYCH</h2>
            <h3 class="activity-subtitle" id="activity-subtitle">Applied Problems to Reality</h3>

            <div class="instructions" id="instructions-box">
                <p id="instruction-text">
                    Write three situations from everyday life related to the three philosophical problems. 
                    From the same, write the problem and the solution. 
                    At the end comment on: The use of philosophy in everyday life.
                </p>
                <p id="instruction-note" style="margin-top: 15px; font-size: 0.95em;">
                    <strong id="note-label">Note:</strong> 
                    <span id="note-text">You can only write in the text fields. Copy and paste is disabled.</span>
                </p>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 120px;"></th>
                            <th id="col1-header">Problem of Reality and Being</th>
                            <th id="col2-header">Problem of Man</th>
                            <th id="col3-header">Problem of God</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- PROBLEMA Row -->
                        <tr>
                            <td class="row-label" id="row1-label">PROBLEM</td>
                            <td>
                                <textarea 
                                    class="cell-input" 
                                    id="cell_problem_1"
                                    placeholder="Write here..."
                                    onpaste="return false"
                                    oncopy="return false"
                                    oncut="return false"
                                    ondragstart="return false"
                                    ondrop="return false"
                                    onchange="updateWordCount('cell_problem_1')"
                                    onkeyup="updateWordCount('cell_problem_1')"
                                ></textarea>
                                <div class="word-count" id="count_problem_1">0 words</div>
                            </td>
                            <td>
                                <textarea 
                                    class="cell-input" 
                                    id="cell_problem_2"
                                    placeholder="Write here..."
                                    onpaste="return false"
                                    oncopy="return false"
                                    oncut="return false"
                                    ondragstart="return false"
                                    ondrop="return false"
                                    onchange="updateWordCount('cell_problem_2')"
                                    onkeyup="updateWordCount('cell_problem_2')"
                                ></textarea>
                                <div class="word-count" id="count_problem_2">0 words</div>
                            </td>
                            <td>
                                <textarea 
                                    class="cell-input" 
                                    id="cell_problem_3"
                                    placeholder="Write here..."
                                    onpaste="return false"
                                    oncopy="return false"
                                    oncut="return false"
                                    ondragstart="return false"
                                    ondrop="return false"
                                    onchange="updateWordCount('cell_problem_3')"
                                    onkeyup="updateWordCount('cell_problem_3')"
                                ></textarea>
                                <div class="word-count" id="count_problem_3">0 words</div>
                            </td>
                        </tr>

                        <!-- SOLUCI√ìN Row -->
                        <tr>
                            <td class="row-label" id="row2-label">SOLUTION</td>
                            <td>
                                <textarea 
                                    class="cell-input" 
                                    id="cell_solution_1"
                                    placeholder="Write here..."
                                    onpaste="return false"
                                    oncopy="return false"
                                    oncut="return false"
                                    ondragstart="return false"
                                    ondrop="return false"
                                    onchange="updateWordCount('cell_solution_1')"
                                    onkeyup="updateWordCount('cell_solution_1')"
                                ></textarea>
                                <div class="word-count" id="count_solution_1">0 words</div>
                            </td>
                            <td>
                                <textarea 
                                    class="cell-input" 
                                    id="cell_solution_2"
                                    placeholder="Write here..."
                                    onpaste="return false"
                                    oncopy="return false"
                                    oncut="return false"
                                    ondragstart="return false"
                                    ondrop="return false"
                                    onchange="updateWordCount('cell_solution_2')"
                                    onkeyup="updateWordCount('cell_solution_2')"
                                ></textarea>
                                <div class="word-count" id="count_solution_2">0 words</div>
                            </td>
                            <td>
                                <textarea 
                                    class="cell-input" 
                                    id="cell_solution_3"
                                    placeholder="Write here..."
                                    onpaste="return false"
                                    oncopy="return false"
                                    oncut="return false"
                                    ondragstart="return false"
                                    ondrop="return false"
                                    onchange="updateWordCount('cell_solution_3')"
                                    onkeyup="updateWordCount('cell_solution_3')"
                                ></textarea>
                                <div class="word-count" id="count_solution_3">0 words</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Commentary Section -->
            <div style="margin-top: 30px;">
                <label style="display: block; font-weight: bold; color: var(--azul-oscuro); margin-bottom: 10px; font-size: 1.05em;" id="commentary-label">
                    Commentary: The use of philosophy in everyday life
                </label>
                <textarea 
                    class="cell-input" 
                    id="commentary"
                    placeholder="Write your commentary here..."
                    style="min-height: 150px;"
                    onpaste="return false"
                    oncopy="return false"
                    oncut="return false"
                    ondragstart="return false"
                    ondrop="return false"
                    onchange="updateWordCount('commentary')"
                    onkeyup="updateWordCount('commentary')"
                ></textarea>
                <div class="word-count" id="count_commentary">0 words</div>
            </div>

            <!-- Buttons -->
            <div class="button-group">
                <button class="btn btn-primary" onclick="guardarActividad()" id="save-btn">Save Activity</button>
                <button class="btn btn-primary" onclick="descargarPDF()" id="download-pdf-btn" style="background: linear-gradient(135deg, #f7be00 0%, #e0a800 100%); color: var(--azul-oscuro);">Download PDF</button>
                <button class="btn btn-secondary" onclick="limpiarActividad()" id="clear-btn">Clear</button>
            </div>

            <!-- Message -->
            <div id="mensaje" class="message"></div>
        </div>

        <div class="footer">
            <p id="footer-text">¬© 2026 Escolaris - Education to Transcend</p>
        </div>
    </div>

    <script>
        // Translations
        const textos = {
            en: {
                'header-title': 'TASK / INVESTIGATION',
                'header-subtitle': 'Escolaris - Education to Transcend',
                'activity-title': 'TRIPTYCH',
                'activity-subtitle': 'Applied Problems to Reality',
                'instruction-text': 'Write three situations from everyday life related to the three philosophical problems. From the same, write the problem and the solution. At the end comment on: The use of philosophy in everyday life.',
                'note-label': 'Note:',
                'note-text': 'You can only write in the text fields. Copy and paste is disabled.',
                'col1-header': 'Problem of Reality and Being',
                'col2-header': 'Problem of Man',
                'col3-header': 'Problem of God',
                'row1-label': 'PROBLEM',
                'row2-label': 'SOLUTION',
                'commentary-label': 'Commentary: The use of philosophy in everyday life',
                'save-btn': 'Save Activity',
                'download-pdf-btn': 'Download PDF',
                'clear-btn': 'Clear',
                'save-success': 'Activity saved successfully!',
                'download-success': 'PDF downloaded! You can share it with your teacher.',
                'footer-text': '¬© 2026 Escolaris - Education to Transcend',
                'word-format': '{0} words'
            },
            es: {
                'header-title': 'TAREA / INVESTIGACI√ìN',
                'header-subtitle': 'Escolaris - Educaci√≥n para trascender',
                'activity-title': 'TR√çPTICO',
                'activity-subtitle': 'Problemas Aplicados a la Realidad',
                'instruction-text': 'Escriba tres situaciones de la vida cotidiana relacionados con los tres problemas filos√≥ficos. De los mismos escriba el problema y la soluci√≥n. Al terminar comente sobre: El uso de la filosof√≠a en la vida cotidiana.',
                'note-label': 'Nota:',
                'note-text': 'Solo puede escribir en los campos de texto. Copiar y pegar est√° deshabilitado.',
                'col1-header': 'Problema de la realidad y del ser',
                'col2-header': 'Problema del hombre',
                'col3-header': 'Problema de Dios',
                'row1-label': 'PROBLEMA',
                'row2-label': 'SOLUCI√ìN',
                'commentary-label': 'Comentario: El uso de la filosof√≠a en la vida cotidiana',
                'save-btn': 'Guardar Actividad',
                'download-pdf-btn': 'Descargar PDF',
                'clear-btn': 'Limpiar',
                'save-success': '¬°Actividad guardada exitosamente!',
                'download-success': '¬°PDF descargado! Puedes compartirlo con tu maestra.',
                'footer-text': '¬© 2026 Escolaris - Educaci√≥n para trascender',
                'word-format': '{0} palabras'
            }
        };

        let idioma = 'en';

        function changeLanguage(lang) {
            idioma = lang;
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            actualizarTextos();
        }

        function actualizarTextos() {
            const t = textos[idioma];

            document.getElementById('header-title').textContent = t['header-title'];
            document.getElementById('header-subtitle').textContent = t['header-subtitle'];
            document.getElementById('activity-title').textContent = t['activity-title'];
            document.getElementById('activity-subtitle').textContent = t['activity-subtitle'];
            
            document.getElementById('instruction-text').textContent = t['instruction-text'];
            document.getElementById('note-label').textContent = t['note-label'];
            document.getElementById('note-text').textContent = t['note-text'];

            document.getElementById('col1-header').textContent = t['col1-header'];
            document.getElementById('col2-header').textContent = t['col2-header'];
            document.getElementById('col3-header').textContent = t['col3-header'];

            document.getElementById('row1-label').textContent = t['row1-label'];
            document.getElementById('row2-label').textContent = t['row2-label'];

            document.getElementById('commentary-label').textContent = t['commentary-label'];

            document.getElementById('save-btn').textContent = t['save-btn'];
            document.getElementById('download-pdf-btn').textContent = t['download-pdf-btn'];
            document.getElementById('clear-btn').textContent = t['clear-btn'];
            document.getElementById('footer-text').textContent = t['footer-text'];

            // Update placeholders
            const placeholderText = idioma === 'es' ? 'Escribe aqu√≠...' : 'Write here...';
            document.querySelectorAll('.cell-input').forEach(input => {
                input.placeholder = placeholderText;
            });

            // Update word counts
            updateAllWordCounts();
        }

        function updateWordCount(fieldId) {
            const textarea = document.getElementById(fieldId);
            const text = textarea.value.trim();
            const words = text === '' ? 0 : text.split(/\s+/).length;
            const countEl = document.getElementById('count_' + fieldId.replace('cell_', '').replace('commentary', 'commentary'));
            
            if (countEl) {
                if (idioma === 'es') {
                    countEl.textContent = words + ' palabras';
                } else {
                    countEl.textContent = words + ' words';
                }
            }
        }

        function updateAllWordCounts() {
            ['problem_1', 'problem_2', 'problem_3', 'solution_1', 'solution_2', 'solution_3', 'commentary'].forEach(id => {
                const fieldId = id.includes('cell_') ? id : 'cell_' + id;
                const el = document.getElementById(fieldId);
                if (el) {
                    updateWordCount(fieldId);
                }
            });
        }

        function guardarActividad() {
            const datos = {
                problem_1: document.getElementById('cell_problem_1').value,
                problem_2: document.getElementById('cell_problem_2').value,
                problem_3: document.getElementById('cell_problem_3').value,
                solution_1: document.getElementById('cell_solution_1').value,
                solution_2: document.getElementById('cell_solution_2').value,
                solution_3: document.getElementById('cell_solution_3').value,
                commentary: document.getElementById('commentary').value
            };

            localStorage.setItem('triptico_filosofia', JSON.stringify(datos));

            const mensaje = document.getElementById('mensaje');
            mensaje.textContent = textos[idioma]['save-success'];
            mensaje.className = 'message success';

            setTimeout(() => {
                mensaje.className = 'message';
            }, 3000);
        }

        function descargarPDF() {
            const datos = {
                problem_1: document.getElementById('cell_problem_1').value,
                problem_2: document.getElementById('cell_problem_2').value,
                problem_3: document.getElementById('cell_problem_3').value,
                solution_1: document.getElementById('cell_solution_1').value,
                solution_2: document.getElementById('cell_solution_2').value,
                solution_3: document.getElementById('cell_solution_3').value,
                commentary: document.getElementById('commentary').value
            };

            const tempDiv = document.createElement('div');
            tempDiv.style.width = '900px';
            tempDiv.style.padding = '20px';
            tempDiv.style.backgroundColor = 'white';
            tempDiv.style.fontFamily = 'Arial, sans-serif';
            tempDiv.style.color = '#244b5a';
            tempDiv.style.lineHeight = '1.6';

            const lang = idioma;
            const labels = {
                en: {
                    title: 'TRIPTYCH',
                    subtitle: 'Applied Problems to Reality',
                    col1: 'Problem of Reality and Being',
                    col2: 'Problem of Man',
                    col3: 'Problem of God',
                    problem: 'PROBLEM',
                    solution: 'SOLUTION',
                    commentary: 'Commentary: The use of philosophy in everyday life',
                    date: 'Date',
                    notCompleted: 'Not completed'
                },
                es: {
                    title: 'TR√çPTICO',
                    subtitle: 'Problemas Aplicados a la Realidad',
                    col1: 'Problema de la realidad y del ser',
                    col2: 'Problema del hombre',
                    col3: 'Problema de Dios',
                    problem: 'PROBLEMA',
                    solution: 'SOLUCI√ìN',
                    commentary: 'Comentario: El uso de la filosof√≠a en la vida cotidiana',
                    date: 'Fecha',
                    notCompleted: 'No completado'
                }
            };

            const lbl = labels[lang];

            let html = `
                <div style="border-bottom: 4px solid #db6015; margin-bottom: 30px; padding-bottom: 20px;">
                    <div style="font-size: 24px; font-weight: bold; color: #db6015; margin-bottom: 10px;">üìö ESCOLARIS</div>
                    <h1 style="color: #244b5a; font-size: 28px; margin: 0;">${lbl.title}</h1>
                    <div style="color: #f7be00; font-size: 18px; margin-top: 5px;">${lbl.subtitle}</div>
                </div>

                <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                    <thead>
                        <tr style="background-color: #db6015;">
                            <th style="color: white; padding: 12px; border: 1px solid #db6015; text-align: center; width: 100px; font-size: 13px;"></th>
                            <th style="color: white; padding: 12px; border: 1px solid #db6015; text-align: center; font-size: 13px;">${lbl.col1}</th>
                            <th style="color: white; padding: 12px; border: 1px solid #db6015; text-align: center; font-size: 13px;">${lbl.col2}</th>
                            <th style="color: white; padding: 12px; border: 1px solid #db6015; text-align: center; font-size: 13px;">${lbl.col3}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="background-color: #db6015; color: white; padding: 12px; border: 1px solid #db6015; text-align: center; font-weight: bold; font-size: 12px;">${lbl.problem}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; font-size: 12px; white-space: pre-wrap;">${escapeHtml(datos.problem_1) || '<em>' + lbl.notCompleted + '</em>'}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; font-size: 12px; white-space: pre-wrap;">${escapeHtml(datos.problem_2) || '<em>' + lbl.notCompleted + '</em>'}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; font-size: 12px; white-space: pre-wrap;">${escapeHtml(datos.problem_3) || '<em>' + lbl.notCompleted + '</em>'}</td>
                        </tr>
                        <tr>
                            <td style="background-color: #db6015; color: white; padding: 12px; border: 1px solid #db6015; text-align: center; font-weight: bold; font-size: 12px;">${lbl.solution}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; font-size: 12px; white-space: pre-wrap;">${escapeHtml(datos.solution_1) || '<em>' + lbl.notCompleted + '</em>'}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; font-size: 12px; white-space: pre-wrap;">${escapeHtml(datos.solution_2) || '<em>' + lbl.notCompleted + '</em>'}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; font-size: 12px; white-space: pre-wrap;">${escapeHtml(datos.solution_3) || '<em>' + lbl.notCompleted + '</em>'}</td>
                        </tr>
                    </tbody>
                </table>

                <div style="background-color: #f0f8ff; border-left: 4px solid #db6015; padding: 20px; margin: 30px 0; border-radius: 5px;">
                    <h3 style="color: #db6015; font-size: 14px; margin-bottom: 15px;">${lbl.commentary}</h3>
                    <div style="font-size: 12px; color: #244b5a; padding: 10px; background-color: white; border-radius: 3px; white-space: pre-wrap;">
                        ${escapeHtml(datos.commentary) || '<em>' + lbl.notCompleted + '</em>'}
                    </div>
                </div>

                <div style="text-align: right; font-size: 11px; color: #999; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd;">
                    ${lbl.date}: ${new Date().toLocaleString(idioma === 'es' ? 'es-ES' : 'en-US')}
                </div>

                <div style="text-align: center; font-size: 12px; color: #D96017; margin-top: 30px; font-weight: bold;">
                    eSCHOLARIS
                </div>
            `;

            tempDiv.innerHTML = html;
            document.body.appendChild(tempDiv);

            html2canvas(tempDiv, {
                scale: 2,
                logging: false,
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'letter'
                });

                const imgWidth = 203;
                const pageHeight = 250;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 3.5, position + 10, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 3.5, position + 10, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                const filename = idioma === 'es' ? 'Tr√≠ptico_Filosof√≠a' : 'Triptych_Philosophy';
                pdf.save(`${filename}_${new Date().getTime()}.pdf`);
                document.body.removeChild(tempDiv);

                const mensaje = document.getElementById('mensaje');
                mensaje.textContent = textos[idioma]['download-success'];
                mensaje.className = 'message success';

                setTimeout(() => {
                    mensaje.className = 'message';
                }, 3000);
            }).catch(err => {
                console.error('Error:', err);
                document.body.removeChild(tempDiv);
            });
        }

        function limpiarActividad() {
            const confirmMsg = idioma === 'es' ? '¬øEst√°s seguro de que deseas limpiar todos los campos?' : 'Are you sure you want to clear all fields?';
            if (confirm(confirmMsg)) {
                document.getElementById('cell_problem_1').value = '';
                document.getElementById('cell_problem_2').value = '';
                document.getElementById('cell_problem_3').value = '';
                document.getElementById('cell_solution_1').value = '';
                document.getElementById('cell_solution_2').value = '';
                document.getElementById('cell_solution_3').value = '';
                document.getElementById('commentary').value = '';
                localStorage.removeItem('triptico_filosofia');
                updateAllWordCounts();
            }
        }

        window.addEventListener('load', function() {
            const datosGuardados = localStorage.getItem('triptico_filosofia');
            if (datosGuardados) {
                const datos = JSON.parse(datosGuardados);
                document.getElementById('cell_problem_1').value = datos.problem_1 || '';
                document.getElementById('cell_problem_2').value = datos.problem_2 || '';
                document.getElementById('cell_problem_3').value = datos.problem_3 || '';
                document.getElementById('cell_solution_1').value = datos.solution_1 || '';
                document.getElementById('cell_solution_2').value = datos.solution_2 || '';
                document.getElementById('cell_solution_3').value = datos.solution_3 || '';
                document.getElementById('commentary').value = datos.commentary || '';
            }
            actualizarTextos();
        });

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('dragover', (e) => {
            e.preventDefault();
            return false;
        });

        document.addEventListener('drop', (e) => {
            e.preventDefault();
            return false;
        });
    </script>
</body>
</html>
